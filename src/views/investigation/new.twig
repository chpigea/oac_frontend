{% set showSidebar = true %}
{% extends "../base.twig" %}

{% block extendHead %}
    <script src="/{{ root }}/js/lib/shacl-form.bundle.js" type="module"></script>

<script type="module">
document.addEventListener("DOMContentLoaded", () => {
    const form = document.querySelector("shacl-form");
    if (!form) return;

    const disableIDField = () => {
        const shadow = form.shadowRoot;
        if (!shadow) return false;

        // Trova la label "ID"
        const label = Array.from(shadow.querySelectorAll("label"))
            .find(l => l.textContent.trim() === "ID");
        if (!label) return false;

        // Container della property
        const container = label.closest(".property-instance");
        if (!container) return false;

        // Disabilita rokit-input
        const rokitInput = container.querySelector("rokit-input");
        if (rokitInput) {
            rokitInput.setAttribute("disabled", "true");
            rokitInput.style.opacity   = "0.6";
            rokitInput.style.pointerEvents = "none";
        }

        // SHACL NODE superiore che contiene TUTTO il blocco ID
        const shaclNode = container.closest("shacl-node");

        // Rimuovi TUTTI i remove-button
        if (shaclNode) {
            shaclNode.querySelectorAll("div.remove-button-wrapper").forEach(el => {
                el.style.display = "none";
            });
            shaclNode.querySelectorAll("rokit-button.remove-button").forEach(btn => {
                btn.style.display = "none";
            });

            // Rimuovi TUTTI gli add-button all'interno del nodo ID
            shaclNode.querySelectorAll("rokit-select.add-button").forEach(btn => {
                btn.style.display = "none";
            });
        }

        return true;
    };

    const observer = new MutationObserver(() => {
        if (disableIDField()) observer.disconnect();
    });

    observer.observe(form, { childList: true, subtree: true });
    setTimeout(() => disableIDField(), 1500);
});
</script>




{% endblock %}

{% block content %}
    
    <div>
        <h2 style="display:flex; justify-content:space-between; align-items:center;">    
            <span>Nuova Indagine:</span>
        </h2>
    </div>

    <shacl-form data-shapes-url="/backend/ontology/schema/ttl2"></shacl-form>

    <script>
      const form = document.querySelector("shacl-form")
      form.addEventListener('change', event => {
        // check if form data validates according to the SHACL shapes
        if (event.detail?.valid) {
          // get data graph as RDF triples and
          // log them to the browser console
          const triples = form.serialize() 
          console.log('entered form data', triples)
          // store the data somewhere, e.g. in a triple store
        }
      })
    </script>

{% endblock %}